@using LOG.PropznetCRM.Data.Core
@using LOG.PropznetCRM.Data.Entities.Enum
<link href="~/Content/css/select2-bootstrap.css" rel="stylesheet" />
<link href="~/Content/css/select2.css" rel="stylesheet" />
<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
<div class="">
    <div class="col-md-6 row">
        <h3 class="inline-b">Manage Potentials</h3>
    </div>
   
        <div class="btn-right pull-right">
            @if (@PermissionChecker.CheckPermission(ViewBag.UserPermissions, PermissionCodes.ManagePotential))
            {
                <button type="button" class="btn btn-primary pull-right" data-bind="click:clear" data-toggle="modal" data-target="#CreatePotential" data-backdrop="static"><i class="fa fa-plus"></i> Potential</button>
            }
        </div>
    
    <div class="clearfix"></div>
    <div class="bdr marB-md pad-sm clearfix">
        <div class="col-md-2">
            <div class="row">
                <select data-bind="options: $root.Salesstage ,optionsText: 'Name', optionsValue: 'Id', value:SearchSalesStage, optionsCaption:'Select Sales Stage'" class="form-control"></select>
            </div>
        </div>
        <div class="col-md-3">
            <select data-bind="options: $root.Leadsource ,optionsText: 'Name', optionsValue: 'Id', value:SearchLeadSource, optionsCaption:'Select LeadSource'" class="form-control"></select>
        </div>
        <div class="col-md-2">
            <select data-bind="options: $root.Agent ,optionsText: 'Name', optionsValue: 'Id', value:SearchAgent, optionsCaption:'Assigned To'" class="form-control"></select>
        </div>
        <div class="col-md-4">
            <select data-bind="options: $root.propertytype ,optionsText: 'Name', optionsValue: 'Id', value:SearchPropertyType, optionsCaption:'Select Property Type'" class="form-control"></select>
        </div>
        <div class="pull-right">
            <button type="button" class="btn btn-primary f-width" data-bind="click:search"><i class="fa fa-search"></i> Search</button>
        </div>
    </div>
    <div class="clearfix"></div>
    <table class="table table-striped table-bordered table-responsive table-hover" data-toggle="table" id="pagination" data-url="data2.json" data-pagination="true" data-search="true">
        <thead class="bg-grey">
            <tr>
                <th class="text-center">Potential No</th>
                <th class="text-center">Potential Name</th>
                <th class="text-center">Related To</th>
                <th class="text-center">Sales Stage</th>
                <th class="text-center">Property Type</th>
                <th class="text-center">Expected Closing Date</th>
                <th class="text-center">Lead Source</th>
                <th class="text-center">Assigned To</th>
                <th class="text-center"> Actions </th>
            </tr>
        </thead>
        <tbody data-bind='foreach:$root.PotentialLists'>
            <tr>
                <td><span data-bind="text: RefId"> </span></td>
                <td><span data-bind="text: PotentialName"> </span></td>
                <td><span data-bind="text: AccountName"> </span></td>
                <td><span data-bind="text: SalesStageName"> </span></td>
                <td><span data-bind="text: PropertyType"> </span></td>
                <td><span data-bind="text: ShowingDate"> </span></td>
                <td><span data-bind="text: LeadSourceName"> </span></td>
                <td><span data-bind="text: AgentName"> </span></td>
                <td>
                    <a href="#" data-bind="click:$root.potentialdetail" data-toggle="modal" data-target="#PotentialDetails"><i class="fa fa-lg fa-info-circle " data-toggle="tooltip" data-placement="top" title="Details" data-original-title="Details"></i></a>&nbsp;&nbsp;
                    @if (@PermissionChecker.CheckPermission(ViewBag.UserPermissions, PermissionCodes.ManagePotential))
                    {
                        <a href="#" data-bind="click:$root.ToDo"><i class="fa fa-lg fa-calendar " data-toggle="tooltip" data-placement="top" title="To Do" data-original-title="To Do"></i></a>@:&nbsp;&nbsp;
                        <a href="#" data-bind="click:$root.potentialedit" data-toggle="modal" data-target="#CreatePotential" data-backdrop="static"><i class="fa fa-lg fa-pencil-square-o " data-toggle="tooltip" data-placement="top" title="Edit" data-original-title="Edit"></i></a>@:&nbsp;&nbsp;
                        <a href="#" data-bind="click:$root.potentialdelete"><i class="fa fa-lg fa-trash-o" data-toggle="tooltip" data-placement="top" title="Delete" data-original-title="Delete"></i></a>
                    }
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="modal fade" id="CreatePotential" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">

        <div class="modal-content">
            <div class="modal-header bg-primary">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <strong><span data-bind="text:DisplayTitle"></span></strong>
            </div>
            <div class="modal-body clearfix">
                <div id="potentialDiv" data-bind="with:SelectedPotential">
                    <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                        <div class="panel panel-default">
                            <div class="panel-heading" role="tab" id="headingOne">
                                <h4 class="panel-title">
                                    <a data-toggle="collapse" id="potentialInfo" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                        Potential Information
                                        <i id="potentialInformationIcon" class="indicator fa fa-chevron-down  pull-right"></i>
                                    </a>
                                    
                                </h4>
                            </div>
                            <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
                                <div class="panel-body">
                                    <div class="col-lg-12 padTB-sm">
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label>Potential Name</label><span class="mandatory">*</span>
                                                <input type="text" class="form-control" data-bind="value:PotentialName" />
                                            </div>
                                            <div class="form-group">
                                                <label>Related To Account</label><span class="mandatory">*</span>
                                                <select id="AccountSelect" data-bind="options: $root.Account ,optionsText: 'Name', optionsValue: 'Id', value:AccountId, optionsCaption:'Select Account'" class="select2-drop-mask atagcolor form-control"></select>
                                                <button class="btn btn-primary" data-toggle="modal" data-target="#createAccount"><i class="fa fa-plus"></i></button>
                                            </div>
                                            <div class="form-group">
                                                <label>Contact</label>
                                                <select data-bind="options: $root.Contacts ,optionsText: 'FirstName', optionsValue: 'Id', value:SelectedContact, optionsCaption:'Select Contact'" class="form-control"></select>
                                            </div>
                                            <div class="form-group">
                                                <label>Lead Source</label>
                                                <select data-bind="options: $root.Leadsource ,optionsText: 'Name', optionsValue: 'Id', value:SelectedLeadSource, optionsCaption:'Select Lead Source'" class="form-control"></select>
                                            </div>
                                            <div class="form-group">
                                                <label data-bind="visible:IsDropdownVisbility">Agent</label>
                                                <select data-bind="options: $root.Agent ,optionsText: 'Name', optionsValue: 'Id', value:selectedAgent, optionsCaption:'Select Agent',visible:IsDropdownVisbility" class="form-control"></select>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label>Expected Amount</label>
                                                <input type="text" class="form-control" data-bind="value:PotentialAmount,numericOnly:true" />
                                            </div>
                                            <div class="form-group">
                                                <label>Expected Close Date</label>
                                                <input type="text" class="form-control" data-bind="datepicker:ExpectedCloseDate,datepickerOptions: { 'dateFormat': 'dd/mm/yy' },value:ExpectedCloseDate" />
                                            </div>
                                            <div class="form-group">
                                                <label>Sales Stage</label><span class="mandatory">*</span>
                                                <select data-bind="options: $root.Salesstage ,optionsText: 'Name', optionsValue: 'Id', value:SelectedSalesStage, optionsCaption:'Select Sales Stage'" class="form-control"></select>
                                            </div>
                                            <div class="form-group">
                                                <label>Assigned To</label><span class="mandatory">*</span>
                                                <select data-bind="options: $root.Agent ,optionsText: 'Name', optionsValue: 'Id', value:selectedAssignedTo, optionsCaption:'Select Agent'" class="form-control"></select>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </div>
                        <div class="panel panel-default">
                            <div class="panel-heading" role="tab" id="headingTwo">
                                <h4 class="panel-title">
                                    <a class="collapsed" id="propertyInfo" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                        Property Information
                                        <i id="propertyInfoIcon" class="indicator fa fa-chevron-down  pull-right"></i>
                                    </a>
                                    
                                </h4>
                            </div>
                            <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
                                <div class="panel-body">
                                    <div class="col-lg-12 padTB-sm">
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label>Type of Property:</label>
                                                <select data-bind="options: $root.propertycategories ,optionsText: 'Name', optionsValue: 'Id', value:selectedPropertyCategory, optionsCaption:'Select Category'" class="form-control"></select>
                                            </div>
                                            <div class="form-group">
                                                <label>Emirates</label>
                                                <select data-bind="options: $root.states ,optionsText: 'Name', optionsValue: 'Id', value:selectedState, optionsCaption:'Select State'" class="form-control"></select>
                                            </div>
                                            <div class="form-group">
                                                <label>Location</label>
                                                <select data-bind="options: $root.SelectedPotential().locations ,optionsText: 'Name', optionsValue: 'Id', value:selectedLocation, optionsCaption:'Select Location'" class="form-control"></select>
                                            </div>
                                            <div class="form-group">
                                                <label>Floor</label>
                                                <input type="text" class="form-control" data-bind="value:Floor,numericOnly:true" />
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label>Area</label>
                                                <input type="text" class="form-control" data-bind="value:Area,numericOnly:true" />
                                            </div>
                                            <div class="form-group">
                                                <label>Requirement</label>
                                                <select data-bind="options: $root.propertytype ,optionsText: 'Name', optionsValue: 'Id', value:selectedProperty, optionsCaption:'Select Property Type'" class="form-control"></select>
                                            </div>
                                            <div class="form-group">
                                                <label>Budget From</label>
                                                <input type="text" class="form-control" data-bind="value:BudgetFrom,numericOnly:true" />
                                            </div>
                                            <div class="form-group">
                                                <label>Budget To</label>
                                                <input type="text" class="form-control" data-bind="value:BudgetTo,numericOnly:true" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel panel-default">
                            <div class="panel-heading" role="tab" id="headingThree">
                                <h4 class="panel-title">
                                    <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                        Descriptions
                                        <i class="indicator fa fa-chevron-down  pull-right"></i>
                                    </a>
                                    
                                </h4>
                            </div>
                            <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
                                <div class="panel-body">
                                    <div class="col-lg-12 padTB-sm">
                                        <div class="col-lg-11">
                                            <label>Comments</label>
                                            <textarea class="form-control" data-bind="value:Comments"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="col-md-12">
                    <button type="button" class="btn btn-default" data-dismiss="modal" aria-hidden="true">Cancel</button>
                    <button type="button" class="btn btn-primary" data-bind="click:$root.savePotential,visible:isCreate">Save</button>
                    <button type="button" class="btn btn-primary" data-bind="click:$root.updatePotential,visible:isUpdate">Update</button>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="PotentialDetails" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">

        <div class="modal-content">
            <div class="modal-header bg-primary">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <strong>Potential Details</strong>
            </div>
            <div class="modal-body clearfix">
                <ul class="nav nav-tabs">
                    <li class="active"><a href="#potential" data-toggle="tab">Potential</a></li>
                    <li><a href="#more" data-toggle="tab">More</a></li>
                </ul>
                <div id="myTabContent" class="tab-content" data-bind="with:SelectedPotential">
                    <div class="tab-pane fade active in" id="potential">
                        <div class="col-lg-12">
                            <div class="form-group">
                                <label class="lblwidth"><b>Potential Name</b>&nbsp;</label>
                                <label class="lblwidth" data-bind="text:PotentialName"></label>
                            </div>
                            <div class="form-group">
                                <label class="lblwidth"><b>Potential Amount</b>&nbsp;</label>
                                <span data-bind="text:PotentialAmount"></span>
                            </div>
                            <div class="form-group">
                                <label class="lblwidth"><b>Expected Close Date</b>&nbsp;</label>
                                <span data-bind="text:ExpectedCloseDate"></span>
                            </div>
                            <div class="form-group">
                                <label class="lblwidth"><b>Account</b>&nbsp;</label>
                                <span data-bind="text:AccountName"></span>
                            </div>
                            <div class="form-group">
                                <label class="lblwidth"><b>Sales Stage</b>&nbsp;</label>
                                <span data-bind="text:SalesStageName"></span>
                            </div>
                            <div class="form-group">
                                <label class="lblwidth"><b>Assigned To</b>&nbsp;</label>
                                <span data-bind="text:AgentName"></span>
                            </div>
                            <div class="form-group">
                                <label class="lblwidth"><b>Lead Source</b>&nbsp;</label>
                                <span data-bind="text:LeadSourceName"></span>
                            </div>

                        </div>
                    </div>
                    <div class="tab-pane fade" id="more">
                        <div class="panel-group" id="accordionAccount">
                            <div class="panel panel-default">
                                <div class="panel-heading new-panel-head">
                                    <h4 class="panel-title">
                                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordionAccount" href="#collapseAccount">
                                            Account
                                            <i class="fa fa-angle-down  pull-right"></i>
                                        </a>
                                    </h4>
                                </div>
                                <div id="collapseAccount" class="panel-collapse collapse in">
                                    <div class="panel-body">
                                        <table class="table table-responsive table-striped">
                                            <thead>
                                                <tr>
                                                    <th class="text-center">Account No</th>
                                                    <th class="text-center">Account Name</th>
                                                    <th class="text-center">Industry</th>
                                                </tr>
                                                <tr>
                                                    <td class="text-center" data-bind="text:ContactName"></td>
                                                    <td class="text-center" data-bind="text:AccountName"></td>
                                                    <td class="text-center" data-bind="text:Industry"></td>
                                                </tr>
                                            </thead>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="panel panel-default">
                                <div class="panel-heading new-panel-head">
                                    <h4 class="panel-title">
                                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordionAccount" href="#collapseContact">
                                            Contact
                                            <i class="fa fa-angle-down  pull-right"></i>
                                        </a>
                                    </h4>
                                </div>
                                <div id="collapseContact" class="panel-collapse collapse">
                                    <div class="panel-body">
                                        <table class="table table-responsive table-striped">
                                            <thead>
                                                <tr>
                                                    <th class="text-center">Contact No</th>
                                                    <th class="text-center">Name</th>
                                                    <th class="text-center">Title</th>
                                                </tr>
                                                <tr>
                                                    <td class="text-center" data-bind="text:ContactNo"></td>
                                                    <td class="text-center" data-bind="text:ContactName"></td>
                                                    <td class="text-center" data-bind="text:ContactTitle"></td>
                                                </tr>
                                            </thead>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="panel panel-default">
                                <div class="panel-heading new-panel-head">
                                    <h4 class="panel-title">
                                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordionAccount" href="#collapseProperty">
                                            Property
                                            <i class="fa fa-angle-down pull-right"></i>
                                        </a>
                                    </h4>
                                </div>
                                <div id="collapseProperty" class="panel-collapse collapse">
                                    <div class="panel-body">
                                        <table class="table table-responsive table-striped">
                                            <thead>
                                                <tr>
                                                    <th class="text-center">Type</th>
                                                    <th class="text-center">Category</th>
                                                    <th class="text-center">Area</th>
                                                    <th class="text-center">Floor</th>
                                                    <th class="text-center">Budget From</th>
                                                    <th class="text-center">Budget To</th>
                                                </tr>
                                                <tr>
                                                    <td class="text-center" data-bind="text:PropertyType"></td>
                                                    <td class="text-center" data-bind="text:PropertyCategory"></td>
                                                    <td class="text-center" data-bind="text:PropertyArea"></td>
                                                    <td class="text-center" data-bind="text:PropertyFloor"></td>
                                                    <td class="text-center" data-bind="text:PropertyBudgetFrom"></td>
                                                    <td class="text-center" data-bind="text:PropertyBudgetTo"></td>
                                                </tr>
                                            </thead>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="createAccount" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">

        <div class="modal-content">
            <div class="modal-header bg-primary">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <strong><span data-bind="text:DisplayTitle"></span></strong>
            </div>
            <div class="modal-body clearfix" data-bind="with:SelectedAccount">
                <h4 class="text-primary">Account Details</h4>
                <div class="col-lg-12 bdr">
                    <div class="col-md-6">

                        <div class="form-group ">
                            <label>Account Name</label>
                            <input type="text" data-bind="value:AccountName" class="form-control" />
                        </div>

                        <div class="form-group">
                            <label>Industry</label>
                            <input type="text" data-bind="value:Industry" class="form-control" />
                        </div>

                        <div class="form-group">
                            <label>Website</label>
                            <input type="text" data-bind="value:Website" class="form-control" />
                        </div>
                    </div>
                    <div class="col-md-6 ">
                        <div class="form-group">
                            <label>Email</label>
                            <input type="text" data-bind="value:Email" class="form-control" />
                        </div>
                        <div class="form-group">
                            <label>Phone</label>
                            <input type="text" data-bind="value:Phone,numericOnly:true" class=" form-control" />
                        </div>
                        <div class="form-group">
                            <label>Assigned To</label>
                            <select data-bind="options: $root.Agent ,optionsText: 'Name', optionsValue: 'Id', value:SelectedAssignedto" class="form-control"></select>
                        </div>

                    </div>
                </div>
                <h4 class="text-primary">Address Information</h4>
                <div class="col-lg-12 bdr">
                    <div class="col-lg-12">
                        <div class="form-group">
                            <textarea class="form-control" data-bind="value:Address" rows="4"></textarea>
                        </div>
                    </div>
                </div>
                <h4 class="text-primary">Other</h4>
                <div class="col-lg-12 bdr">
                    <div class="col-lg-12">
                        <div class="form-group">
                            <label>Comments</label>
                            <textarea data-bind="value:Comment" class=" form-control" rows="4"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="col-md-12">
                    <button type="button" class="btn btn-default" data-dismiss="modal" aria-hidden="true">Cancel</button>
                    <button type="button" class="btn btn-primary" data-bind="click:$root.CreateAccount,visible:isCreate">Save</button>
                    <button type="button" class="btn btn-primary" data-bind="click:$root.updateAccount,visible:isUpdate">Update</button>
                </div>
            </div>
        </div>
    </div>
</div>
@section scripts{
    <script src="~/Scripts/moment.min.js"></script>
    <script src="~/Content/js/jquery-ui.js"></script>
<script src="~/Content/js/select2.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            var vm = new PotentialViewModel();
            ko.applyBindings(vm);
            vm.init();
        });
    </script>
}