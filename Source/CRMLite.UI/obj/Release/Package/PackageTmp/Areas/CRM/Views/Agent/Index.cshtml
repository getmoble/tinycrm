@using CRMLite.Infrastructure
@using CRMLite.Infrastructure.Enum
@{
    ViewBag.Title = "List";
}
<div class="col-md-12">
    <div class="col-md-6 row">
        <div class="m-top20">
            <h3 class="inline-b">Manage Agents</h3>
        </div>
    </div>
    
       
            @if (@PermissionChecker.CheckPermission(ViewBag.UserPermissions, PermissionCodes.ManageAgent))
{
    <button type="button" class="btn btn-primary pull-right m-r-xs m-t-lg m-bottom10 " data-bind="click:gotoAgentPage"><i class="fa fa-plus"></i></button>
}
        
  
    <div class="clearfix"></div>
    <div class="bdr marB-md pad-sm clearfix">
        <div class="col-md-4 row m-b-md">
            <input type="text" class="form-control" data-bind="value:SearchName" placeholder="First Name" />
        </div>
        <div class="col-md-3">
            <input type="text" class="form-control" data-bind="value:SearchEmail" placeholder="Email" />
        </div>
        <div class="col-md-4">
            <input type="text" class="form-control" data-bind="value:SearchPhone,numericOnly:true" placeholder="Phone" />
        </div>
        <div class="pull-right">
            <button type="button" class="btn btn-primary f-width" data-bind="click:search"><i class="fa fa-search"></i> Search</button>
        </div>
    </div>
    <div class="clearfix"></div>
    <div data-bind="loading:$root.isBusy">
        <table class="table table-striped table-bordered table-responsive table-hover" data-toggle="table" id="pagination" data-url="data2.json" data-pagination="true" data-search="true">
            <thead class="bg-grey">
            <tr>
                <th class="text-center">Agent Id </th>
                <th class="text-center">First Name </th>
                <th class="text-center">Last Name </th>
                <th class="text-center">Email</th>
                <th class="text-center">Phone</th>
                <th class="text-center"> Actions </th>
            </tr>
            </thead>
            <tbody data-bind='foreach:$root.AgentLists'>
            <tr>
                <td><span data-bind="text: refId"> </span></td>
                <td><span data-bind="text: firstname"> </span></td>
                <td><span data-bind="text: lastname"> </span></td>
                <td><span data-bind="text: email"> </span></td>
                <td><span data-bind="text: phoneNumber"> </span></td>
                <td>
                    &nbsp;&nbsp;&nbsp;<a href="#" data-bind="click:$root.gotoAgentdetails"><i class="fa fa-lg fa-info-circle " data-toggle="tooltip" data-placement="top" title="Details" data-original-title="Details"></i></a>&nbsp;&nbsp;&nbsp;
                    @if (@PermissionChecker.CheckPermission(ViewBag.UserPermissions, PermissionCodes.ManageAgent))
                    {
                        <a href="#CreateAgent" data-bind="click:$root.updateAgentProfile"><i class="fa fa-lg fa-pencil-square-o " data-toggle="tooltip" data-placement="top" title="Edit" data-original-title="Edit"></i></a>@:&nbsp;&nbsp;&nbsp;
                        <a href="#" data-bind="click:$root.agentdelete"><i class="fa fa-lg fa-trash-o" data-toggle="tooltip" data-placement="top" title="Delete" data-original-title="Delete"></i></a>
                    }
                    @if (!@PermissionChecker.CheckPermission(ViewBag.UserPermissions, PermissionCodes.ManageAgent) && @RoleChecker.CheckRole(ViewBag.RoleId, RoleIds.Agent))
                    {
                        <a href="#UpdateAgentProfile" data-bind="click:$root.updateAgentProfile"><i class="fa fa-lg fa-pencil-square-o " data-toggle="tooltip" data-placement="top" title="Edit" data-original-title="Edit"></i></a>@:&nbsp;&nbsp;&nbsp;
                    }
                </td>
            </tr>
            </tbody>
        </table>
        </div>
    </div>

<div class="modal fade" id="CreateAgent" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-primary">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <strong><span data-bind="text:DisplayTitle"></span></strong>
            </div>
            <div class="modal-body clearfix" data-bind="with:selectedAgent">
                <div class="col-lg-12 pad0 padB0">
                    <div class="col-md-6">

                        <div class="form-group ">
                            <label>First Name</label>
                            <input type="text" data-bind="value:firstname" class="form-control" />
                        </div>

                        <div class="form-group">
                            <label>Last Name</label>
                            <input type="text" data-bind="value:lastname" class="form-control" />
                        </div>

                        <div class="form-group">
                            <label>Email</label>
                            <input type="text" data-bind="value:email" class="form-control" />
                        </div>

                        <div class="form-group">
                            <label>Phone</label>
                            <input type="text" data-bind="value:phoneNumber,numericOnly:true" class="form-control" />
                        </div>

                        <div class="form-group">
                            <label>Address</label>
                            <textarea data-bind="value:address" class="form-control"></textarea>
                        </div>
                    </div>
                    <div class="col-md-6 ">
                        <label>&nbsp;</label>
                        <div class="form-group">
                            <input type="checkbox" data-bind="checked:islistingmember" /> <label> Listing Member</label>
                        </div>

                        <div class="form-group">
                            <label>DED License No</label>
                            <input type="text" data-bind="value:DEDlicenseNumber" class=" form-control" />
                        </div>

                        <div class="form-group">
                            <label>RERA Registration No</label>
                            <input type="text" data-bind="value:RERAregistrationNumber" class=" form-control" />
                        </div>
                        <div class="form-group">
                            <div class="btn-group">
                                <input id="avatar" class="btn btn-primary uploadbtn" type="file" name="avatar" accept=".jpg,.jpeg,.png,.gif" data-bind="text:image" />
                            </div>
                            <div class="nailthumb-container">
                                <img id=ThumbnailImageS height=85 width=90 border=0 data-bind=" attr:{src: image}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="col-md-12 pad0 padT0">
                    <button type="button" class="btn btn-default" data-dismiss="modal" aria-hidden="true">Cancel</button>
                    <button type="button" class="btn btn-primary" data-bind="click:$root.saveAgent,visible:isCreate">Save</button>
                    <button type="button" class="btn btn-primary" data-bind="click:$root.updateAgent,visible:isUpdate">Update</button>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts{
<script src="~/App/ViewModels/CRM/models.js"></script>
<script src="~/App/ViewModels/Agent/AgentViewModel.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            var vm = new AgentViewModel();
            ko.applyBindings(vm);
            vm.AgentListing();
        });
    </script>
}